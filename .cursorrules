# TB Personal OS - Instru√ß√µes de Desenvolvimento

> Este arquivo cont√©m as diretrizes e contexto para o desenvolvimento cont√≠nuo do projeto.

## üìã Vis√£o do Projeto

**TB Personal OS** √© um assistente pessoal operacional e evolutivo que funciona como um "segundo c√©rebro":
- **Captura** entradas via Telegram, web, links, arquivos
- **Processa** com IA (Gemini) para classificar, extrair entidades e sugerir a√ß√µes
- **Executa** a√ß√µes via integra√ß√µes (Google Calendar, Gmail, Drive, Tasks)
- **Aprende** detectando padr√µes e recomendando melhorias
- **Evolui** continuamente baseado em dados reais

## üèóÔ∏è Stack Tecnol√≥gico

### Backend
- **Python 3.11+** com FastAPI 0.108
- **Supabase** (Auth, PostgreSQL 15+, Storage)
- **Gemini API** (LLM principal)
- **python-telegram-bot v13.x** (polling mode)
- **Structlog** para logging estruturado

### Frontend
- **React 18+** com Vite
- **TypeScript** strict mode
- **TailwindCSS** + HeadlessUI
- **React Query** para data fetching
- **Zustand** para state management

### Database
- PostgreSQL via Supabase
- 18 tabelas definidas em `supabase/migrations/00001_initial_schema.sql`
- ENUMs para status e categorias

## üìÅ Estrutura do Projeto

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # Entry point FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py           # Settings (Pydantic)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logging_config.py   # Structlog setup
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py     # Router principal
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dependencies/   # Auth, DB connections
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ endpoints/      # Rotas por m√≥dulo
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # Pydantic schemas
‚îÇ   ‚îú‚îÄ‚îÄ services/               # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gemini_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inbox_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bot_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ integrations/           # Google APIs, etc
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ tests/
‚îî‚îÄ‚îÄ requirements.txt

frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/             # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ pages/                  # P√°ginas/views
‚îÇ   ‚îú‚îÄ‚îÄ services/               # API clients
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                  # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ contexts/               # React Context
‚îÇ   ‚îú‚îÄ‚îÄ types/                  # TypeScript types
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îî‚îÄ‚îÄ package.json
```

## üéØ Plano de Implementa√ß√£o

### FASE 1: Funda√ß√£o Backend (Atual)
- [x] Estrutura base FastAPI
- [x] Configura√ß√µes centralizadas
- [x] Schema do banco de dados
- [ ] **ETAPA 1.1**: Unificar e corrigir bot handler
- [ ] **ETAPA 1.2**: Criar endpoints API (inbox, tasks)
- [ ] **ETAPA 1.3**: Integrar classifica√ß√£o Gemini real
- [ ] **ETAPA 1.4**: Middleware de autentica√ß√£o

### FASE 2: Integra√ß√µes Google
- [ ] **ETAPA 2.1**: Google OAuth flow
- [ ] **ETAPA 2.2**: Calendar sync (read)
- [ ] **ETAPA 2.3**: Calendar create events
- [ ] **ETAPA 2.4**: Gmail b√°sico

### FASE 3: Bot Telegram Completo
- [ ] **ETAPA 3.1**: Comandos de tasks
- [ ] **ETAPA 3.2**: Comandos de check-in
- [ ] **ETAPA 3.3**: Rotinas autom√°ticas (manh√£/noite)
- [ ] **ETAPA 3.4**: Contexto de mem√≥ria

### FASE 4: Frontend MVP
- [ ] **ETAPA 4.1**: Layout e navega√ß√£o
- [ ] **ETAPA 4.2**: Autentica√ß√£o Supabase
- [ ] **ETAPA 4.3**: Dashboard inbox
- [ ] **ETAPA 4.4**: Tasks view

### FASE 5: ML e Insights
- [ ] **ETAPA 5.1**: Job scheduler
- [ ] **ETAPA 5.2**: Padr√µes de produtividade
- [ ] **ETAPA 5.3**: Recomenda√ß√µes simples

## üîß Padr√µes de C√≥digo

### Python/Backend
```python
# Imports organizados
from typing import List, Optional, Dict
from datetime import datetime
import structlog

# Logger por m√≥dulo
logger = structlog.get_logger(__name__)

# Async por padr√£o
async def my_function() -> dict:
    """Docstring obrigat√≥ria."""
    pass

# Type hints obrigat√≥rios
def process_item(item_id: str, data: dict) -> Optional[dict]:
    pass
```

### Endpoints API
```python
# Padr√£o de resposta
{
    "success": True,
    "data": {...},
    "message": "Operation completed"
}

# Padr√£o de erro
{
    "success": False,
    "error": {
        "code": "VALIDATION_ERROR",
        "message": "Description"
    }
}
```

### Telegram Bot
```python
# Comandos seguem padr√£o
def command_handler(update: Update, context: CallbackContext):
    """Handler para /comando"""
    user = update.effective_user
    
    # Verificar owner
    if user.id != self.owner_chat_id:
        return
    
    # Processar...
    update.message.reply_text("Resposta", parse_mode=ParseMode.MARKDOWN)
```

## üóÑÔ∏è Tabelas Principais

| Tabela | Uso |
|--------|-----|
| `users` | Usu√°rios do sistema |
| `profiles` | Prefer√™ncias e configura√ß√µes |
| `telegram_chats` | V√≠nculo Telegram ‚Üî User |
| `inbox_items` | Entrada unificada |
| `tasks` | Tarefas e to-dos |
| `habits` | H√°bitos rastreados |
| `checkins` | Registros de m√©tricas |
| `projects` | Projetos e iniciativas |
| `contacts` | Pessoas e empresas |
| `content_ideas` | Ideias de conte√∫do |
| `assistant_logs` | Logs de todas as a√ß√µes |
| `recommendations` | Recomenda√ß√µes do sistema |

## üîê Vari√°veis de Ambiente Necess√°rias

```env
# Application
APP_ENV=development
API_SECRET_KEY=

# Supabase
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_KEY=

# Google
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=
GOOGLE_SCOPES=calendar,gmail,drive

# Gemini
GEMINI_API_KEY=
GEMINI_MODEL=gemini-pro

# Telegram
TELEGRAM_BOT_TOKEN=
OWNER_TELEGRAM_CHAT_ID=
```

## üìù Comandos √öteis

```bash
# Desenvolvimento
cd backend && uvicorn app.main:app --reload

# Bot Telegram (polling)
cd backend && python -m app.bot_simple

# Frontend
cd frontend && npm run dev

# Docker
docker-compose up -d
```

## ‚ö†Ô∏è Pontos de Aten√ß√£o

1. **Bot usa v13.x**: Sintaxe diferente da v20+, usar `Updater` e `dispatcher`
2. **Supabase Auth**: Usar JWT do Supabase para autentica√ß√£o
3. **Gemini API**: Verificar rate limits e custos
4. **Timezone**: Sempre usar `America/Sao_Paulo` como padr√£o

## üéØ Objetivo Atual

Implementar a **FASE 1** completamente para ter um backend funcional com:
- Bot Telegram processando mensagens com IA
- API REST para frontend
- Classifica√ß√£o inteligente via Gemini
- Autentica√ß√£o b√°sica

---
*√öltima atualiza√ß√£o: 18/01/2026*
